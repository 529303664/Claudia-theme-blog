<!DOCTYPE html><html class="appearance-auto" lang="zh-cn"><head><meta charset="UTF-8"><title>awk命令的基本使用</title><meta name="description" content="完善自己"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><link rel="icon"><link rel="stylesheet" href="/My-Blogs/style/bulma.css"><link rel="stylesheet" href="/My-Blogs/style/base.css"><link rel="stylesheet" href="/My-Blogs/style/helper.css"><script src="/My-Blogs/js/main.js"></script><link rel="stylesheet" href="/My-Blogs/style/post.css"><link rel="stylesheet" href="/My-Blogs/style/highlight-theme-light.css"><script src="/My-Blogs/jslib/highlight.pack.js"></script><meta name="generator" content="Hexo 5.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/My-Blogs/atom.xml" title="John Doe's blog" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-mobile"><section class="is-hidden-mobile"><h2><a href="/My-Blogs/">Lucas's blog</a></h2></section><h3 class="is-hidden-mobile"></h3><aside><h3 class="is-inline-block"><a href="/My-Blogs/">Home</a></h3><h3 class="is-inline-block"><a href="/My-Blogs/about">About</a></h3><h3 class="is-inline-block"><a href="/My-Blogs/archives">Archives</a></h3></aside></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/My-Blogs/">Home</a></h3><h3 class="is-inline-block"><a href="/My-Blogs/about">About</a></h3><h3 class="is-inline-block"><a href="/My-Blogs/archives">Archives</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F"><span class="toc-text">语法格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%8F%82%E6%95%B0"><span class="toc-text">常用参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%84%9A%E6%9C%AC%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-text">脚本基本结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Awk%E7%9A%84%E5%8F%98%E9%87%8F"><span class="toc-text">Awk的变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="toc-text">内置变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Awk%E8%BF%90%E7%AE%97%E4%B8%8E%E5%88%A4%E6%96%AD"><span class="toc-text">Awk运算与判断</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">算术运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">赋值运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">正则运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">逻辑运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">关系运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">其它运算符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Awk%E6%AD%A3%E5%88%99"><span class="toc-text">Awk正则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Awk%E5%AE%9E%E4%BE%8B%E4%BB%8B%E7%BB%8D"><span class="toc-text">Awk实例介绍</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/My-Blogs/tags/Linux"><i class="tag post-item-tag">Linux</i></a><a href="/My-Blogs/tags/shell"><i class="tag post-item-tag">shell</i></a><a href="/My-Blogs/tags/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86"><i class="tag post-item-tag">文件处理</i></a></header><h1 class="mt-0 mb-1 is-family-serif">awk命令的基本使用</h1><time class="has-text-grey" datetime="2021-01-08T17:19:22.000Z">2021-01-08</time><article class="mt-2 post-content"><p>Awk  pattern scanning and processing language，对文本和数据进行处理。</p>
<p>awk 是一种编程语言，用于在linux/unix下对文本和数据进行处理。数据可以来自标准输(stdin)、一个或多个文件，或其它命令的输出。它在命令行中使用，但更多是作为脚本来使用。awk有很多内建的功能，比如数组、函数等，这是它和C语言的相同之处，灵活性是awk最大的优势。</p>
<a id="more"></a>

<h2 id="语法格式"><a href="#语法格式" class="headerlink" title="语法格式"></a>语法格式</h2><pre><code class="BASH">awk&nbsp;[options]&nbsp;'scripts'&nbsp;var=value&nbsp;filename</code></pre>
<h2 id="常用参数"><a href="#常用参数" class="headerlink" title="常用参数"></a>常用参数</h2><pre><code class="BASH">-F&nbsp;指定分隔符（可以是字符串或正则表达式）
-f&nbsp;从脚本文件中读取awk命令
-v&nbsp;var=value&nbsp;赋值变量，将外部变量传递给awk</code></pre>
<h2 id="脚本基本结构"><a href="#脚本基本结构" class="headerlink" title="脚本基本结构"></a>脚本基本结构</h2><pre><code class="BASH">awk&nbsp;'BEGIN{&nbsp;print&nbsp;"start"&nbsp;}&nbsp;pattern{&nbsp;commands&nbsp;}&nbsp;END{&nbsp;print&nbsp;"end"&nbsp;}'&nbsp;filename</code></pre>
<p>一个awk脚本通常由BEGIN语句+模式匹配+END语句三部分组成, 这三部分都是可选项.</p>
<p>工作原理:</p>
<ul>
<li>第一步执行BEGIN 语句</li>
<li>第二步从文件或标准输入读取一行，然后再执行pattern语句，逐行扫描文件到文件全部被读取</li>
<li>第三步执行END语句</li>
</ul>
<p>实例展示:</p>
<pre><code class="BASH">echo&nbsp;"hello&nbsp;"&nbsp;|&nbsp;awk&nbsp;'BEGIN{&nbsp;print&nbsp;"welcome"&nbsp;}&nbsp;END{&nbsp;print&nbsp;"2017-08-08"&nbsp;}'
welcome
2017-08-08
echo&nbsp;-e&nbsp;"hello"&nbsp;|&nbsp;awk&nbsp;'BEGIN{&nbsp;print&nbsp;"welcome"&nbsp;}&nbsp;{print}&nbsp;END{&nbsp;print&nbsp;"2017-08-08"&nbsp;}'
welcome
hello
2017-08-08
#不加print参数时默认只打印当前的行
echo|awk&nbsp;'{&nbsp;a="hello";&nbsp;b="nihao";&nbsp;c="mingongge";&nbsp;print&nbsp;a,b,c;&nbsp;}'
hello&nbsp;nihao&nbsp;mingongge
#使用print以逗号分隔时，打印则是以空格分界
echo|awk&nbsp;'{&nbsp;a="mgg";&nbsp;b="mingg";&nbsp;c="mingongge";&nbsp;print&nbsp;a"&nbsp;is&nbsp;"b"&nbsp;or&nbsp;"c;&nbsp;}'
mgg&nbsp;is&nbsp;mingg&nbsp;or&nbsp;mingongge
#awk的print语句中双引号其实就是个拼接作用</code></pre>
<h2 id="Awk的变量"><a href="#Awk的变量" class="headerlink" title="Awk的变量"></a>Awk的变量</h2><h3 id="内置变量"><a href="#内置变量" class="headerlink" title="内置变量"></a>内置变量</h3><pre><code class="BASH">$0&nbsp;&nbsp;&nbsp;#当前记录
$1~$n&nbsp;#当前记录的第N个字段
FS&nbsp;&nbsp;&nbsp;#输入字段分隔符（-F相同作用）默认空格
RS&nbsp;&nbsp;&nbsp;#输入记录分割符，默认换行符
NF&nbsp;&nbsp;&nbsp;#字段个数就是列 
NR&nbsp;&nbsp;&nbsp;#记录数，就是行号，默认从1开始
OFS&nbsp;&nbsp;#输出字段分隔符，默认空格
ORS&nbsp;&nbsp;#输出记录分割符，默认换行符 </code></pre>
<p>外部变量</p>
<pre><code class="BASH">[mingongge@&nbsp;~]#a=100
[mingongge@&nbsp;~]#b=100
[mingongge@&nbsp;~]#echo&nbsp;|awk&nbsp;'{print&nbsp;v1*v2&nbsp;}'&nbsp;v1=$a&nbsp;v2=$b
10000</code></pre>
<h2 id="Awk运算与判断"><a href="#Awk运算与判断" class="headerlink" title="Awk运算与判断"></a>Awk运算与判断</h2><h3 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h3><pre><code class="BASH">+&nbsp;-&nbsp;加减
*&nbsp;/&nbsp;&amp;&nbsp;乘&nbsp;除&nbsp;求余
^&nbsp;*&nbsp;&nbsp;求幂
++&nbsp;--&nbsp;增加或减少，作为前缀或后缀</code></pre>
<pre><code class="BASH">[mingongge@&nbsp;~]#awk&nbsp;'BEGIN{a="b";print&nbsp;a,a++,a--,++a;}'
b&nbsp;0&nbsp;1&nbsp;1
[mingongge@&nbsp;~]#awk&nbsp;'BEGIN{a="0";print&nbsp;a,a++,a--,++a;}'
0&nbsp;0&nbsp;1&nbsp;1
[mingongge@&nbsp;~]#awk&nbsp;'BEGIN{a="0";print&nbsp;a,a++,--a,++a;}'
0&nbsp;0&nbsp;0&nbsp;1
#和其它编程语言一样，所有用作算术运算符进行操作，操作数自动转为数值，所有非数值都变为0</code></pre>
<h3 id="赋值运算符"><a href="#赋值运算符" class="headerlink" title="赋值运算符"></a>赋值运算符</h3><pre><code class="BASH">=&nbsp;+=&nbsp;-=&nbsp;*=&nbsp;/=&nbsp;%=&nbsp;^=&nbsp;**=</code></pre>
<h3 id="正则运算符"><a href="#正则运算符" class="headerlink" title="正则运算符"></a>正则运算符</h3><pre><code class="BASH">~&nbsp;!~&nbsp;&nbsp;匹配正则表达式/不匹配正则表达式</code></pre>
<h3 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h3><pre><code class="BASH">||&nbsp;&nbsp;&amp;&amp;&nbsp;&nbsp;逻辑或&nbsp;&nbsp;逻辑与</code></pre>
<h3 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h3><pre><code class="BASH">&lt;&nbsp;&lt;=&nbsp;&gt;&nbsp;&gt;=&nbsp;!=&nbsp;= </code></pre>
<h3 id="其它运算符"><a href="#其它运算符" class="headerlink" title="其它运算符"></a>其它运算符</h3><pre><code class="BASH">$&nbsp;&nbsp;&nbsp;字段引用&nbsp;
空格&nbsp;字符串链接符
?:&nbsp;&nbsp;&nbsp;三目运算符
ln&nbsp;&nbsp;&nbsp;数组中是否存在某键值</code></pre>
<h2 id="Awk正则"><a href="#Awk正则" class="headerlink" title="Awk正则"></a>Awk正则</h2><pre><code class="BASH">^&nbsp;&nbsp;&nbsp;&nbsp;行首定位符
$&nbsp;&nbsp;&nbsp;&nbsp;行尾定位符
.&nbsp;&nbsp;&nbsp;&nbsp;匹配任意单个字符
*&nbsp;&nbsp;&nbsp;&nbsp;匹配0个或多个前导字符（包括回车）
+&nbsp;&nbsp;&nbsp;&nbsp;匹配1个或多个前导字符
?&nbsp;&nbsp;&nbsp;&nbsp;匹配0个或1个前导字符&nbsp;
[]&nbsp;&nbsp;&nbsp;匹配指定字符组内的任意一个字符/^[ab]
[^]&nbsp;&nbsp;匹配不在指定字符组内的任意一个字符
()&nbsp;&nbsp;&nbsp;子表达式
|&nbsp;&nbsp;&nbsp;&nbsp;或者
&nbsp;&nbsp;&nbsp;&nbsp;转义符
~,!~&nbsp;匹配或不匹配的条件语句
x{m}&nbsp;x字符重复m次
x{m,}&nbsp;x字符至少重复m次
X{m,n}&nbsp;x字符至少重复m次但不起过n次（需指定参数-posix或--re-interval）</code></pre>
<h2 id="Awk实例介绍"><a href="#Awk实例介绍" class="headerlink" title="Awk实例介绍"></a>Awk实例介绍</h2><pre><code class="BASH">awk&nbsp;–F&nbsp;:&nbsp;‘{print&nbsp;$2}’&nbsp;datafile
#以:分隔打印第二列
awk&nbsp;–F&nbsp;:&nbsp;‘/^Dan/{print&nbsp;$2}’&nbsp;datafile
#以:分隔打印以Dan开头行的第二列内容
awk&nbsp;–F&nbsp;:&nbsp;‘/^[CE]/{print&nbsp;$1}’&nbsp;datafile&nbsp;
#打印以C或E开头行的第一列
awk&nbsp;–F&nbsp;:&nbsp;‘{if(length($1)&nbsp;==&nbsp;4)&nbsp;print&nbsp;$1}’&nbsp;datafile&nbsp;
#打印以:分隔且长度为4字符的第一列内容
awk&nbsp;–F&nbsp;:&nbsp;‘/[916]/{print&nbsp;$1}’&nbsp;datafile
#匹配916的行以:分隔打印第一列
awk&nbsp;-F&nbsp;:&nbsp;'/^Vinh/{print&nbsp;"a"$5}'&nbsp;2.txt
#显示以Dan开头行并在第五列前加上a
awk&nbsp;–F&nbsp;:&nbsp;‘{print&nbsp;$2”,”$1}’&nbsp;&nbsp;datafile
#打印第二列第一列并以,分隔
awk&nbsp;-F&nbsp;:&nbsp;'($5&nbsp;==&nbsp;68900)&nbsp;{print&nbsp;$1}'&nbsp;2.txt
#以:分隔打印第五列是68900的行第一列 
awk&nbsp;-F&nbsp;:&nbsp;'{if(length($1)&nbsp;==&nbsp;11)&nbsp;print&nbsp;$1}'&nbsp;2.txt
#打印以:分隔且长度为4字符的第一列内容
awk&nbsp;-F&nbsp;:&nbsp;'$1~/Tommy&nbsp;Savage/&nbsp;{print&nbsp;$5}'&nbsp;2.txt
awk&nbsp;-F&nbsp;:&nbsp;'($1&nbsp;==&nbsp;"Tommy&nbsp;Savage")&nbsp;{print&nbsp;$5}'&nbsp;2.txt
#打印以:分隔且第一列为Tommy&nbsp;Savage的第五列内容
ll&nbsp;|awk&nbsp;'BEGIN&nbsp;{size=0;}&nbsp;{size=size+$5;}&nbsp;END{print&nbsp;"[end]size&nbsp;is&nbsp;",size}'
#统计目录个的文件所有的字节数
awk&nbsp;'BEGIN{size=0;}&nbsp;{size=size+$5;}&nbsp;END{print&nbsp;"[end]size&nbsp;is&nbsp;",size/1024/1024,"M"}'&nbsp;
#以M为单位显示目录下的所有字节数
awk&nbsp;'BEGIN{a=10;a+=10;print&nbsp;a}'
20&nbsp;
#a+10等价于&nbsp;a=a+10
echo|awk&nbsp;'BEGIN{a="100testaaa"}a~/test/{print&nbsp;"ok"}'&nbsp;
#正则匹配a&nbsp;是否有test字符，成立打印ok
awk&nbsp;'BEGIN{a="b";print&nbsp;a=="b"?"ok":"err"}'
ok
awk&nbsp;'BEGIN{a="b";print&nbsp;a=="c"?"ok":"err"}'
err
#三目运算符?:
awk&nbsp;'/root/{print&nbsp;$0}'&nbsp;passwd&nbsp;
#匹配所有包含root的行
awk&nbsp;-F:&nbsp;'$5~/root/{print&nbsp;$0}'&nbsp;passwd&nbsp;
#&nbsp;以分号作为分隔符，匹配第5个字段是root的行
ifconfig&nbsp;eth0|awk&nbsp;'BEGIN{FS="[[:space:]:]+"}&nbsp;NR==2{print&nbsp;$4}'
#打印IP地址
awk&nbsp;'{print&nbsp;toupper($0)}'&nbsp;test.txt
#toupper是awk内置函数，将所小写字母转换成大写</code></pre>
</article><section class="is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-small is-default" href="/My-Blogs/2021/01/08/Linux/shell/%E6%96%87%E4%BB%B6/awk%E7%BB%9F%E8%AE%A1%E6%96%87%E6%9C%AC%E4%B8%AD%E5%90%8C%E4%B8%80%E6%95%B0%E6%8D%AE%E5%87%BA%E7%8E%B0%E7%9A%84%E6%AC%A1%E6%95%B0%E6%8E%92%E5%BA%8F/" title="awk统计文本中同一数据出现的次数排序">Previous</a><a class="button is-small is-default" href="/My-Blogs/2021/01/08/Linux/shell/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/cron%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/" title="cron基本的使用">Next</a></section><article class="mt-6 comment-container"><script src="https://utteranc.es/client.js" repo="529303664/My-Blogs" issue-term="pathname" theme="github-light" async></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com/https://twitter.com/Lucas55207840?s=05"><i class="iconfont icon-twitter"></i></a><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/529303664"><i class="iconfont icon-github"></i></a><!-- Ins--><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com//"><i class="iconfont icon-ins"></i></a><!-- RSS--><a title="rss" target="_blank" rel="noopener nofollow" href="/My-Blogs/atom.xml"><i class="iconfont icon-rss"></i></a><!-- 知乎--><!-- 领英--><!-- 脸书--><a title="facebook" target="_blank" rel="noopener nofollow" href="//www.facebook.com/https://www.facebook.com/profile.php?id=100010703889793"><i class="iconfont icon-tian7_facebook"></i></a></section><p><span>Copyright ©</span><span> Lucas 2022</span></p><div class="is-flex"><p>Powered by Hexo｜</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by &nbspHaojen&nbsp</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script>hljs.initHighlighting();

var directory = document.querySelectorAll('.toc a')
if (directory.length > 0) {
    var contentTocList = []
    var activeClassName = 'is-active'

    directory.forEach(function (link) {
        if (!link.href) return
        var id = decodeURI(link.href).split('#')[1]
        contentTocList.push(document.getElementById(id))
    })

    var DELAY = 150
    var needWait = false
    window.addEventListener('scroll', function (evt) {
        if (needWait) {
            return
        }
        needWait = true
        var tocContainer = document.querySelector('.toc')
        setTimeout(function () {
            var spacing = 60
            var activeTopicEl = null
            var scrollTop = window.pageYOffset
            for (var i = 0; i < contentTocList.length; i++) {
                var currentTopic = contentTocList[i]

                if (currentTopic.offsetTop > scrollTop + spacing / 2) {
                    // jump to next loop
                    continue
                }

                if (!activeTopicEl) {
                    activeTopicEl = currentTopic
                } else if (currentTopic.offsetTop + spacing >= activeTopicEl.offsetTop - spacing) {
                    activeTopicEl = currentTopic
                }

                var beforeActiveEl = document.querySelector('.toc' + ' .' + activeClassName)
                beforeActiveEl && beforeActiveEl.classList.remove(activeClassName)

                var selectTarget = '.toc a[href="#' + encodeURI(activeTopicEl.id) + '"]'
                var direc = document.querySelector(selectTarget)
                direc.classList.add(activeClassName)

                var tocContainerHeight = tocContainer.getBoundingClientRect().height
                if (direc.offsetTop >= tocContainerHeight - spacing) {
                    tocContainer.scrollTo({
                        // top: direc.offsetTop - spacing,
                        top: direc.offsetTop + 100 - tocContainerHeight,
                    })
                }
                else {
                    tocContainer.scrollTo({ top: 0 })
                }
            }
            needWait = false
        }, DELAY)

    })

}</script></body></html>